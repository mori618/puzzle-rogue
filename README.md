# Puzzle Rogue (パズル・ローグ)

このプロジェクトは、React + Vite で構築されたパズルRPGゲームです。
パズル＆ドラゴンのようなパズル操作感に、ローグライクなトークン・ビルド要素を組み合わせています。

## ✨ 特徴 (Features)

- **直感的なパズル操作**: ドロップを自由に動かしてコンボを狙う、馴染みやすいゲームプレイ。
- **無限のビルド戦略**: サイクルごとにショップで「トークン」を購入・強化し、キャラクターを成長させます。毎回異なるスキルやパッシブの組み合わせで、自分だけの最強ビルドを構築できます。
- **奥深いコンボシステム**: 単純なコンボだけでなく、特定の形（十字、L字、正方形など）で消すことで発動する「形状ボーナス」や、スキル・パッシブ効果によるコンボ加算・倍率アップを駆使してハイスコアを目指します。
- **ハイリスク・ハイリターン**: 「落ちコン」を意図的に停止させる代わりにコンボ倍率を劇的に上げるパッシブなど、戦略の幅を広げるユニークな要素が満載です。

## 🛠️ 技術スタック (Tech Stack)

- **Framework**: [React](https://react.dev/)
- **Build Tool**: [Vite](https://vitejs.dev/)
- **Styling**: [Tailwind CSS](https://tailwindcss.com/)
- **Icons**: [Lucide React](https://lucide.dev/guide/react)
- **Linting**: [ESLint](https://eslint.org/)
- **Deployment**: [GitHub Pages](https://pages.github.com/)

---

## 🎮 ゲーム仕様 (Game Specifications)

### 1. ゲームの目的と流れ
プレイヤーは各「サイクル」の開始時に提示される**目標コンボ数 (Target Combo)**を、規定ターン数内に達成することを目指します。

1.  **パズルフェーズ**: 盤面のドロップを操作してコンボを組み、合計コンボ数を稼ぎます。
2.  **目標達成**: 1サイクル中の合計コンボ数が目標に達すると、そのサイクルはクリアとなります。
3.  **ショップフェーズ**: サイクルクリア後、ショップで「★（スター）」を消費して新しいトークンを購入したり、既存のトークンを強化したりします。
4.  **次のサイクルへ**: ショップを抜けると、より高い目標コンボ数が設定された新しいサイクルが始まります。

このサイクルを繰り返し、どこまでコンボ数を高められるかに挑戦します。

### 2. パズル画面の基本ルール
- **盤面**: 基本は **5行 x 6列**。特定のパッシブスキル（巨人の領域）を装備すると **6行 x 7列** に拡張されます。
- **ドロップ**: 火、水、木、光、闇、回復の6種類。
- **消去条件**: 同じ色のドロップを縦または横に3つ以上揃えると消えます。
- **操作時間**: 基本は **5秒**。パッシブスキルや形状ボーナスによって延長されます。ドロップを掴んでから1マスでも動かすとタイマーが作動します。
- **ターン**: 1手番（1回のドロップ操作）を1ターンとします。
- **サイクル**: 1サイクルは基本 **3ターン** で構成されます。特定のエンチャント（時の刻印）で最大ターン数を増やすことができます。

### 3. コンボ計算式
各ターンで得られる最終的なコンボ数は、以下の式で計算されます。

`最終コンボ数 = floor((基本コンボ数 + ボーナスコンボ数) * コンボ倍率)`

- **基本コンボ数**: パズルで揃えた色の数。
- **ボーナスコンボ数**: スキルやパッシブ効果によって直接加算されるコンボ数。
- **コンボ倍率**: スキルやパッシブ効果によって乗算される倍率。

### 4. 特殊ボーナスとメカニクス

#### 形状ボーナス (Shape Bonus)
特定の形でドロップを消すと、コンボ数や操作時間にボーナスが発生します。
一部の形状は、対応するパッシブスキルを装備していなくても、基本的なボーナスを得られます。

**基本効果 (スキル不要)**
以下のボーナスは、パッシブスキルを装備していなくても常に有効です。

| 形状 | 最小個数 | 基本ボーナス効果 |
| :--- | :--- | :--- |
| **5個以上連結** | 5個 | 基本コンボ数 **+1** |
| **L字消し** | 5個 | 基本コンボ数 **+1** |
| **十字消し** | 5個 | 基本コンボ数 **+2** |

**パッシブスキルによる追加効果**
以下のボーナスは、対応するパッシブスキルを装備している場合にのみ有効になります。

| 形状 | 最小個数 | パッシブ装備時のボーナス効果 |
| :--- | :--- | :--- |
| **4個ちょうど連結** | 4個 | ボーナスコンボ数に加算。 |
| **5個以上連結** | 5個 | **次手**の操作時間に乗算ボーナス。 |
| **L字消し** | 5個 | ボーナスコンボ数に加算。 |
| **十字消し** | 5個 | **次手**の操作時間に乗算ボーナス。 |
| **横一列消し** | 6個 | ボーナスコンボ数に加算。 |
| **3x3正方形消し** | 9個 | **コンボ倍率**に乗算ボーナス。 |

#### 全消しボーナス (All Clear Bonus)
- **初期盤面全消し (All Initial Orbs Cleared)**: 最初の操作で消えたドロップと、その後の落ちコンで消えたドロップの中に、ターン開始時に盤面に存在した全てのドロップが含まれていた場合、そのターンの**最終コンボ数が2倍**になります。
- **盤面全消し (Perfect Clear)**: 落ちコンも含め、最終的に盤面上の全てのドロップが消えた場合、そのターンの**最終コンボ数が2倍**になります。

※注: 1回の操作で両方の条件を満たした場合、「初期盤面全消し」が優先して適用されます（効果の重複はありません）。

#### スキップボーナス (Skip Bonus)
- サイクル目標を達成すると、盤面上に「NEXT GOAL」ボタンが出現します。
- このボタンを押すと、残りのターンをスキップして即座に次のサイクルに進むことができます。
- スキップした場合、**残りターン数 × ボーナス倍率** の★を追加で獲得できます。ボーナス倍率の初期値は**3倍**で、特定のパッシブスキル（時短の心得）で増加します。

### 5. ゲームオーバーと継続
- 規定ターン数内に目標コンボ数を達成できなかった場合、ゲームオーバーとなります。
- ゲームオーバー画面では以下の選択肢があります。
    - **リトライ**: ★を消費せずに**2ターン**を追加してゲームを継続します。
    - **エンドレスモード**: 目標達成のプレッシャーなしに、自由にプレイを続けられるモードに移行します。
    - **最初から**: ゲームを完全にリセットして、最初からやり直します。

---

## 📊 詳細データ (Detailed Data)

### トークン (Tokens)
- プレイヤーは最大6つのトークンを装備できます。
- トークンには、使用することで効果を発揮する**アクティブスキル**と、装備しているだけで常に効果を発揮する**パッシブスキル**の2種類があります。
- 同じトークンを複数装備することはできず、代わりに既存のトークンの**レベル(Lv)**が上がります。レベルが上がると効果が強化されたり、コストが減少したりします。

#### アクティブスキル一覧 (Active Skills)

- **コスト(Cost)**: スキル発動に必要なチャージ量。チャージは1ターン経過するごとに1溜まります。
- **コスト変動**: `costLevels: true` のスキルは、レベルが上がるごとにコストが `1` ずつ減少します（最低コストは基礎コストの半分、または1）。

| 分類 | 名前 (Name) | Lv.1 コスト | 説明 (Description) | 価格 |
| :--- | :--- | :---: | :--- | :---: |
| **単色変換** | 焔の変換 | 3 | 木を火に変換。 | 2 |
| | 氷の変換 | 3 | 火を水に変換。 | 2 |
| | 嵐の変換 | 3 | 水を木に変換。 | 2 |
| | 雷の変換 | 3 | 闇を光に変換。 | 2 |
| | 影の変換 | 3 | 光を闇に変換。 | 2 |
| | 癒の変換 | 3 | 火を回復に変換。 | 2 |
| | 癒しの劫火 | 3 | 回復を火に変換。 | 2 |
| | 癒しの奔流 | 3 | 回復を水に変換。 | 2 |
| | 癒しの深緑 | 3 | 回復を木に変換。 | 2 |
| **複数色変換** | 大地の恵み | 5 | 火と水を木に変換。 | 3 |
| | 福音の祈り | 5 | 光と闇を回復に変換。 | 3 |
| | 冥風の烈火 | 5 | 水と闇を火に変換。 | 3 |
| | 天啓の閃光 | 5 | 木と回復を光に変換。 | 3 |
| | 三原色の福音 | 6 | 火/水/木を回復に変換。 | 4 |
| **盤面生成(陣)** | 三色の真理・紅蓮 | 7 | 盤面を火/水/木に変更。 | 3 |
| | 三色の真理・天地 | 7 | 盤面を光/闇/回復に変更。 | 3 |
| | (他、多数の3色陣) | 7 | 指定された3色で盤面を生成。 | 3 |
| | 双龍の陣 | 8 | 盤面を火/水の2色に変更。 | 4 |
| | (他、多数の2色陣) | 8 | 指定された2色で盤面を生成。 | 4 |
| | 真・紅蓮の極致 | 10 | 盤面すべてを火に変更。 | 6 |
| | 真・閃光の極致 | 10 | 盤面すべてを光に変更。 | 6 |
| **固定列/行生成** | 烈火の横一文字 | 5 | **上段**をすべて火に。 | 3 |
| | 烈火の底陣 | 5 | **下段**をすべて火に。 | 3 |
| | 生命の帯 | 5 | **中央行**をすべて回復に。 | 3 |
| | 閃光の縦一閃 | 5 | **左端列**をすべて光に。 | 3 |
| | 常闇の縦一閃 | 5 | **右端列**をすべて闇に。 | 3 |
| | (他、各属性のスキルが存在) | 5 | | 3 |
| **補助** | 紅蓮の目覚め | 4 | 3手番、火がかなり落ちやすくなる。 | 3 |
| | 双流の波紋 | 4 | 2手番、水と木が落ちやすくなる。 | 3 |
| | 三色の結界 | 6 | 3手番、火/水/木しか落ちてこない。 | 4 |
| | 次元の再編 | 3 | 全ドロップを消去して再落下させる（落ちコンあり）。 | 2 |
| | 練気の波動 | 3 | 他のスキルのエネルギーをチャージする。(Lv.1: +1 / Lv.2: +2 / Lv.3: +3) | 2 |

#### パッシブスキル一覧 (Passive Skills)

| 名前 (Name) | 価格 | 効果 (Lv.1 / Lv.2 / Lv.3) |
| :--- | :---: | :--- |
| **黄金の収集者** | 3 | ★獲得に必要なコンボ数を **4 / 3 / 1** に短縮。 |
| **時の砂** | 2 | 操作時間を **+1 / +2 / +3秒** 延長。 |
| **力の鼓動** | 2 | コンボ加算に **+1 / +2 / +3** の固定値を追加。 |
| **禁忌の儀式** | 5 | 常時落ちコン停止。最終コンボ数を **x1.5 / x2 / x3** 倍。 |
| **商談の極意** | 4 | ショップのセール品（半額）の数を **2 / 3 / 4個** に増加。 |
| **時短の心得** | 4 | スキップボーナスを **x4 / x5 / x6** 倍にする。 |
| **天恵の追撃** | 5 | 落ちコン発生時にコンボ **+3 / +5 / +8**。 |
| **(属性)の連舞** | 4 | 指定1属性を消すとコンボ **x1.3 / x1.5 / x2** 倍。 |
| **(属性)の律動** | 5 | 指定2属性を同時に消すとコンボ **x1.4 / x1.8 / x2.5** 倍。 |
| **三源/三界の律動** | 6 | 指定3属性を同時に消すとコンボ **x1.5 / x2 / x3** 倍。 |
| **四天の秘儀** | 7 | 火/水/光/回復を同時に消すとコンボ **x1.8 / x2.5 / x4** 倍。 |
| **五色の秘儀** | 8 | 5色以上同時消しでコンボ **x2 / x3 / x5** 倍。 |
| **六色の秘儀** | 10 | 6色同時消しでコンボ **x3 / x5 / x8** 倍。 |
| **三連の巧技** | 4 | 3コンボちょうどの時、コンボ **+5 / +10 / +15**。 |
| **十連の極み** | 6 | 10コンボちょうどの時、コンボ **+10 / +15 / +20**。 |
| **七連の闘気** | 7 | 7コンボ以上で最終コンボ **x1.5 / x2 / x3** 倍。 |
| **四連の術** | 3 | 4個ちょうど連結でコンボ **+1 / +2 / +3**。 |
| **横一閃** | 5 | 横1列消しでコンボ **+3 / +6 / +9**。 |
| **四方の型** | 6 | 3x3正方形消しでコンボ **x1.5 / x2 / x3** 倍。 |
| **五星の印** | 5 | 5個以上連結で**次手**の操作時間 **x1.2 / x1.5 / x2** 倍。 |
| **十字の祈り** | 6 | 十字型消しで**次手**の操作時間 **x1.5 / x2 / x3** 倍。 |
| **鉤十字の型** | 6 | L字消しでコンボ **+2 / +4 / +6**。 |
| **癒しの波動** | 4 | 回復ドロップの1コンボにつき、追加でコンボ **+2 / +3 / +4**。 |
| **巨人の領域** | 6 | 盤面が7x6に拡張。コンボ倍率 **x1 / x1.2 / x1.5** 倍。 |

### エンチャント (Enchantments)
トークンにランダムに付与される追加効果。ショップで購入できます。
これらの効果は、コンボ計算式の **ボーナスコンボ数** または **コンボ倍率** に影響します。

| 名前 (Name) | 価格 | 説明 (Description) |
| :--- | :---: | :--- |
| **レベル共鳴** | 8 | このトークンのLv分、**コンボ倍率**に乗算する。(例: Lv.2なら `x2`) |
| **強欲の輝き** | 9 | 現在の所持★数を**ボーナスコンボ数**に加算する。 |
| **連鎖の刻印** | 5 | **ボーナスコンボ数**を一律で **+2** する。 |
| **時の刻印** | 7 | 1サイクルの最大ターン数が **+1** される。 |
| **時の跳躍** | 7 | 前のサイクルまでにスキップした合計ターン数分、**ボーナスコンボ数**に加算する。 |
| **(属性)の加護** | 6 | 指定属性の1コンボにつき、**基本コンボ数**に **+1**。 |

### ショップ (Shop)
- サイクルクリア後に訪れることができる場所。
- 商品はサイクルごとにランダムで入れ替わります。
- **★3**を消費して品揃えを更新（リフレッシュ）することも可能です。
- **セール**: パッシブスキル「商談の極意」を装備していると、セール品（半額）の数が増加します。
- **高級品**: ゲームが進む（`totalPurchases >= 6`）と、エンチャントが付与された高価なトークンが並ぶことがあります。
- **特殊商品**:
    - **ランダム強化**: 所持トークンの中からランダムで1つのレベルを上げます。
    - **ランダム付与**: 所持トークンの中からランダムで1つに、提示されたエンチャントを付与します。

---

## 🚀 開発とデプロイ (Development & Deployment)

### 1. 依存関係のインストール
```bash
npm install
```

### 2. 開発サーバーの起動
```bash
npm run dev
```
ブラウザで `http://localhost:5173` などを開いてください。

### 3. ビルドとデプロイ
このプロジェクトは `gh-pages` を使用して GitHub Pages に簡単にデプロイできます。

**A. `vite.config.js` の確認**
`base` の設定が `'./'` になっていることを確認してください。

**B. デプロイコマンドの実行**
以下のコマンドを実行するだけで、プロジェクトがビルドされ、自動的に `gh-pages` ブランチにプッシュされます。

```bash
npm run deploy
```

**C. GitHub Pages の設定**
1. GitHub リポジトリの **Settings > Pages** を開きます。
2. **Build and deployment > Branch** で `gh-pages` ブランチの `/(root)` を選択して保存します。
3. 公開されるまで数分待ちます。

### その他のコマンド

| コマンド | 説明 |
|:---|:---|
| `npm run build` | プロジェクトを本番用にビルドします。(`dist` フォルダに生成) |
| `npm run preview` | ビルドされた内容をローカルでプレビューします。 |
| `npm run lint` | ESLintを実行してコードの静的解析を行います。 |