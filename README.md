# Puzzle Rogue (パズル・ローグ)

このプロジェクトは、React + Vite で構築されたパズルRPGゲームです。
パズル＆ドラゴンのようなパズル操作感に、ローグライクなトークン・ビルド要素を組み合わせています。

## ✨ 特徴 (Features)

- **直感的なパズル操作**: ドロップを自由に動かしてコンボを狙う、馴染みやすいゲームプレイ。
- **無限のビルド戦略**: サイクルごとにショップで「トークン」を購入・強化し、キャラクターを成長させます。毎回異なるスキルやパッシブの組み合わせで、自分だけの最強ビルドを構築できます。
- **奥深いコンボシステム**: 単純なコンボだけでなく、特定の形（十字、L字、正方形など）で消すことで発動する「形状ボーナス」や、スキル・パッシブ効果によるコンボ加算・倍率アップを駆使してハイスコアを目指します。
- **ハイリスク・ハイリターン**: 「落ちコン」を意図的に停止させる代わりにコンボ倍率を劇的に上げるパッシブなど、戦略の幅を広げるユニークな要素が満載です。

## 🛠️ 技術スタック (Tech Stack)

- **Framework**: [React](https://react.dev/)
- **Build Tool**: [Vite](https://vitejs.dev/)
- **Styling**: [Tailwind CSS](https://tailwindcss.com/)
- **Icons**: [Lucide React](https://lucide.dev/guide/react), [Material Icons](https://fonts.google.com/icons)
- **Linting**: [ESLint](https://eslint.org/)
- **Deployment**: [GitHub Pages](https://pages.github.com/)

---

## 🎮 ゲーム仕様 (Game Mechanics)

### 1. ゲームの目的と流れ
プレイヤーは各「サイクル」の開始時に提示される**目標コンボ数 (Target Combo)**を、規定ターン数内に達成することを目指します。

1.  **パズルフェーズ**: 盤面のドロップを操作してコンボを組み、合計コンボ数を稼ぎます。
2.  **目標達成**: 1サイクル中の合計コンボ数が目標に達すると、そのサイクルはクリアとなります。
3.  **ショップフェーズ**: サイクルクリア後、ショップで「★（スター）」を消費して新しいトークンを購入したり、既存のトークンを強化したりします。**トークンにはレアリティ（★1 コモン 〜 ★3 エピック）があり、ショップ内ではレア度に応じた色の枠で陳列されます。**
4.  **次のサイクルへ**: ショップを抜けると、より高い目標コンボ数が設定された新しいサイクルが始まります。

### 2. パズルルール
- **盤面**: 基本 **5行 x 6列** (パッシブ「巨人の領域」装備時 **6行 x 7列**)。
- **ドロップ (Orbs)**: 火, 水, 木, 光, 闇, 回復 の6種類。
- **消去条件**: 同じ色のドロップを縦または横に3つ以上揃えると消える。
- **操作時間**: 基本 **5秒** (パッシブ効果等で増減)。ドロップを移動開始した瞬間から計測開始。
- **ターン**: 1回の操作 = 1ターン。
- **サイクル**: 基本 **3ターン** 構成 (エンチャント「時の刻印」等で増加可能)。

### 3. 特殊ドロップ (Special Drops)
通常のドロップに加えて、スキルやパッシブ効果によって以下の特殊なドロップが出現することがあります。

- **強化ドロップ (+)**: 消去時のコンボ倍率や加算ボーナスを高めるドロップ。
- **ボムドロップ (Bomb)**: 消去時、または特定の条件で爆発し、周囲のドロップを巻き込んで消去する強力なドロップ。「火薬」系スキルなどで生成できます。
- **リピートドロップ (Repeat)**: 消去時にグループ全体が復活し、リピートドロップが含まれていた数だけ繰り返し消え、コンボ数や効果を再発動させるドロップ。
- **スタードロップ (Star)**: 消去すると、ショップで通貨として使用する「★スター」の獲得量が大幅にアップするドロップ。
- **虹ドロップ (Rainbow/Wildcard)**: 全ての基本属性（火/水/木/光/闇/回復）の代わりとして繋げることができるワイルドカードドロップ。同時に複数色として扱うことも可能ですが、一定回数消去されると消滅します。

### 4. コンボ計算式 (Combo Logic)
各ターンの「最終コンボ数」は以下の計算式で算出されます。

```math
最終コンボ数 = floor( (基本コンボ + ボーナス加算) × コンボ倍率 )
```

- **基本コンボ (Base Combo)**: パズルで実際に揃えたコンボ数。
- **ボーナス加算 (Bonus)**:
  - 形状ボーナス（固定値加算）
  - スキル/パッシブによる加算（例:「+2コンボ」）
  - エンチャント効果（例:「スター数分加算」）
- **コンボ倍率 (Multiplier)**:
  - 形状ボーナス（正方形消し等による倍率）
  - パッシブ効果による倍率（例:「7コンボ以上で2倍」）
  - 全消しボーナス (x2)

### 5. 特殊ボーナス (Special Bonuses)

#### A. 形状ボーナス (Shape Bonus)
特定の形でドロップを消すとボーナスが発生します。パッシブスキルを所持していなくても発生する**基本効果**と、所持していると追加される**強化効果**があります。

| 形状 | 条件 | 基本効果 | パッシブ装備時の追加効果 |
| :--- | :--- | :--- | :--- |
| **5個以上連結** | 5個つながる | コンボ加算 **+1** | **次手**の操作時間に乗算ボーナス<br>(五星の印) |
| **L字消し** | 5個でL字 | コンボ加算 **+1** | ボーナスコンボ数に加算<br>(鉤十字の型) |
| **十字消し** | 5個で十字 | コンボ加算 **+2** | **次手**の操作時間に乗算ボーナス<br>(十字の祈り) |
| **4個消し** | 4個ちょうど | なし | ボーナスコンボ数に加算<br>(四連の術) |
| **横一列消し** | 横全列消去 | なし | ボーナスコンボ数に加算<br>(横一閃) |
| **3x3正方形** | 3x3の9個 | なし | **コンボ倍率**に乗算ボーナス<br>(四方の型) |

#### B. 全消しボーナス (All Clear)
- **初期盤面全消し**: 最初の操作で消えたドロップ + その後の落ちコンで消えたドロップの中に、ターン開始時に存在した**全ての初期ドロップ**が含まれていた場合、**最終コンボ数 x2**。
- **完全盤面全消し (Perfect Clear)**: 落ちコン処理終了後、盤面が完全に空になった場合、**最終コンボ数 x2**。
  ※ 両方満たした場合は「初期盤面全消し」が優先されます（重複なし）。

#### C. スキップボーナス (Skip Bonus)
目標達成後、残りのターンをスキップするとボーナスを獲得。
`獲得★ = 残りターン数 × ボーナス倍率 (基本3倍)`

### 6. 各種画面とUI (Screens & Navigation)
- **タイトル画面 (Title Screen)**: 最初から始めるか、続きから始めるかを選択可。ヘルプや実績画面にもアクセスできます。
- **メイン画面 (Main Screen)**: 操作を行うゲーム画面。パズル盤面の上部付近を**右にスワイプ**することで、手軽にショップを開けます。
- **ショップ画面 (Shop Screen)**: ビルド構築の中核。画面内で**左にスワイプ**すると退出してメイン画面に戻ります。
- **ポーズ画面 (Pause Screen)**: ゲーム中に中断し、ヘルプ・実績の確認やタイトルへ戻る操作が可能です。
- **実績画面 (Stats Screen)**: 現在のプレイ記録や累計スコア、消費スター数や特定形状消しの回数を一覧で確認できます。

---

## 📊 データ一覧 (Data Library)
ゲーム内に登場するトークンの一部を紹介します。度重なるアップデートにより、**ボム、リピート、スター、虹ドロップに関するスキル**や、**ステータス依存の強力なパッシブスキル（〇〇の記憶 等）**など、様々な新スキルが追加されています。

### 1. トークン: アクティブスキル (Active Skills)
装備して使用するスキル。1ターンごとにチャージが1溜まります。
**コスト仕様**: `Lv` が上がると必要コストが `1` ずつ減少します（下限は `ceil(初期コスト/2)` または `1`）。

| 分類 | 名前 (Name) | 初期コスト | 詳細 (Effect) | 価格 |
| :--- | :--- | :---: | :--- | :---: |
| **単色変換** | 焔の変換 | 3 | 木→火 | 2 |
| | 氷の変換 | 3 | 火→水 | 2 |
| | 嵐の変換 | 3 | 水→木 | 2 |
| | 雷の変換 | 3 | 闇→光 | 2 |
| | 影の変換 | 3 | 光→闇 | 2 |
| | 癒の変換 | 3 | 火→回復 | 2 |
| | 癒しの劫火 | 3 | 回復→火 | 2 |
| | 癒しの奔流 | 3 | 回復→水 | 2 |
| | 癒しの深緑 | 3 | 回復→木 | 2 |
| | 癒しの聖光 | 3 | 回復→光 | 2 |
| | 癒しの呪法 | 3 | 回復→闇 | 2 |
| **複数変換** | 大地の恵み | 5 | 火+水→木 | 3 |
| | 福音の祈り | 5 | 光+闇→回復 | 3 |
| | 冥風の烈火 | 5 | 水+闇→火 | 3 |
| | 天啓の閃光 | 5 | 木+回復→光 | 3 |
| | 三原色の福音 | 6 | 火+水+木→回復 | 4 |
| | 三原色の業火 | 6 | 水+木+回復→火 | 4 |
| | 三原色の奔流 | 6 | 火+木+回復→水 | 4 |
| | 三原色の深緑 | 6 | 火+水+回復→木 | 4 |
| | 三原色の閃光 | 6 | 火+水+闇→光 | 4 |
| | 三原色の常闇 | 6 | 火+水+光→闇 | 4 |
| | 薪の焚き付け | 5 | 木+回復→火 | 3 |
| | 混沌の浄化・炎 | 5 | 光+闇→火 | 3 |
| | 鎮火の雨 | 5 | 火+回復→水 | 3 |
| | 混沌の浄化・水 | 5 | 光+闇→水 | 3 |
| | 恵みの雨 | 5 | 水+回復→木 | 3 |
| | 混沌の浄化・木 | 5 | 光+闇→木 | 3 |
| | 浄化の炎 | 5 | 火+闇→光 | 3 |
| | 聖なる泉 | 5 | 水+回復→光 | 3 |
| | 蝕む影 | 5 | 火+光→闇 | 3 |
| | 腐敗の森 | 5 | 木+回復→闇 | 3 |
| **列生成** | 烈火の横一文字 | 5 | 上段→火 | 3 |
| | 清流の横一文字 | 5 | 上段→水 | 3 |
| | 深翠の横一文字 | 5 | 上段→木 | 3 |
| | 閃光の横一文字 | 5 | 上段→光 | 3 |
| | 常闇の横一文字 | 5 | 上段→闇 | 3 |
| | 生命の横一文字 | 5 | 上段→回復 | 3 |
| | 烈火の底陣 | 5 | 下段→火 | 3 |
| | 生命の帯 | 5 | 中央行→回復 | 3 |
| | 閃光の縦一閃 | 5 | 左端列→光 | 3 |
| | 常闇の縦一閃 | 5 | 右端列→闇 | 3 |
| **盤面変化(3色)** | 三色の真理・紅蓮 | 7 | 盤面→火/水/木 | 3 |
| | 三色の真理・天地 | 7 | 盤面→光/闇/回復 | 3 |
| | 三色の真理・黄昏 | 7 | 盤面→火/水/闇 | 3 |
| | 三色の真理・神緑 | 7 | 盤面→光/木/回復 | 3 |
| | 三色の真理・炎光 | 7 | 盤面→火/光/闇 | 3 |
| | 三色の真理・水光 | 7 | 盤面→水/光/闇 | 3 |
| | 三色の真理・木光 | 7 | 盤面→木/光/闇 | 3 |
| | 三色の真理・炎木 | 7 | 盤面→火/木/光 | 3 |
| | 三色の真理・炎闇 | 7 | 盤面→火/木/闇 | 3 |
| | 三色の真理・水木 | 7 | 盤面→水/木/光 | 3 |
| **盤面変化(2色)** | 双龍の陣 | 8 | 盤面→火/水 | 4 |
| | 明暗の陣 | 8 | 盤面→光/闇 | 4 |
| | 風癒の陣 | 8 | 盤面→木/回復 | 4 |
| | 炎光の陣 | 8 | 盤面→火/光 | 4 |
| | 炎闇の陣 | 8 | 盤面→火/闇 | 4 |
| | 水光の陣 | 8 | 盤面→水/光 | 4 |
| | 水闇の陣 | 8 | 盤面→水/闇 | 4 |
| | 木光の陣 | 8 | 盤面→木/光 | 4 |
| | 木闇の陣 | 8 | 盤面→木/闇 | 4 |
| | 紅蓮の至宝 | 8 | 盤面→火/回復 | 4 |
| | 蒼海の至宝 | 8 | 盤面→水/回復 | 4 |
| | 極光の至宝 | 8 | 盤面→光/回復 | 4 |
| | 奈落の至宝 | 8 | 盤面→闇/回復 | 4 |
| | 業火の陣 | 8 | 盤面→火/木 | 4 |
| | 樹氷の陣 | 8 | 盤面→水/木 | 4 |
| **盤面変化(1色)** | 真・紅蓮の極致 | 10 | 盤面すべてを火に変更 (花火) | 6 |
| | 真・蒼海の極致 | 10 | 盤面すべてを水に変更 (花火) | 6 |
| | 真・深翠の極致 | 10 | 盤面すべてを木に変更 (花火) | 6 |
| | 真・閃光の極致 | 10 | 盤面すべてを光に変更 (花火) | 6 |
| | 真・常闇の極致 | 10 | 盤面すべてを闇に変更 (花火) | 6 |
| | 真・生命の極致 | 10 | 盤面すべてを回復に変更 (花火) | 6 |
| **特殊効果** | 紅蓮の目覚め | 4 | 3ターンの間、火が降りやすくなる | 3 |
| | 蒼海の目覚め | 4 | 3ターンの間、水が降りやすくなる | 3 |
| | 深翠の目覚め | 4 | 3ターンの間、木が降りやすくなる | 3 |
| | 閃光の目覚め | 4 | 3ターンの間、光が降りやすくなる | 3 |
| | 常闇の目覚め | 4 | 3ターンの間、闇が降りやすくなる | 3 |
| | 癒しの目覚め | 4 | 3ターンの間、回復が降りやすくなる | 3 |
| | 双流の波紋 | 4 | 2ターンの間、水/木が降りやすくなる | 3 |
| | 炎光の波紋 | 4 | 2ターンの間、火/光が降りやすくなる | 3 |
| | 炎闇の波紋 | 4 | 2ターンの間、火/闇が降りやすくなる | 3 |
| | 水闇の波紋 | 4 | 2ターンの間、水/闇が降りやすくなる | 3 |
| | 木光の波紋 | 4 | 2ターンの間、木/光が降りやすくなる | 3 |
| | 明暗の波紋 | 4 | 2ターンの間、光/闇が降りやすくなる | 3 |
| | 三色の結界 | 6 | 3ターンの間、火/水/木のみ降ってくる | 4 |
| | 三界の結界 | 6 | 3ターンの間、光/闇/回復のみ降ってくる | 4 |
| | 次元の再編 | 3 | ドロップリフレッシュ (落ちコンあり) | 2 |
| | 練気の波動 | 3 | 他スキルのチャージ +[1/2/3] | 2 |
| | クロノス・ストップ | 7 | 10秒間、時間を止めて自由にドロップを動かせる | 7 |
| **強化** | 星の導き・(属性) | 5 | 指定1属性のドロップを強化 | 4 |
| | 星の導き・(2属性) | 7 | 指定2属性のドロップを強化 | 5 |

### 2. トークン: パッシブスキル (Passive Skills)
装備しているだけで効果を発揮するスキル。同じものを入手するとレベルアップします。

| カテゴリ | 名前 (Name) | Lv.1 / Lv.2 / Lv.3 効果 | 価格 |
| :--- | :--- | :--- | :--- |
| **システム** | 黄金の収集者 | ★獲得必要コンボ数を **4 / 3 / 1** に短縮 | 3 |
| | 時の砂 | 操作時間 **+1 / +2 / +3秒** | 2 |
| | 力の鼓動 | コンボ加算 **+1 / +2 / +3** | 2 |
| | 禁忌の儀式 | **落ちコンなし**。コンボ倍率 **x1.5 / x2 / x3** | 5 |
| | 商談の極意 | ショップのセール品数 **2 / 3 / 4個** | 4 |
| | 時短の心得 | スキップボーナス **x4 / x5 / x6** | 4 |
| | 天恵の追撃 | 落ちコン発生時、コンボ **+3 / +5 / +8** | 5 |
| **属性ボーナス** | (属性)の連舞 | 指定1属性消しでコンボ倍率 **x1.3 / x1.5 / x2** | 4 |
| | (属性)の律動 | 指定2属性消しでコンボ倍率 **x1.4 / x1.8 / x2.5** | 5 |
| | 三源/三界/新緑の律動 | 指定3属性消しでコンボ倍率 **x1.5 / x2 / x3** | 6 |
| | 四天の秘儀 | 火水光回消しでコンボ倍率 **x1.8 / x2.5 / x4** | 7 |
| | 五色の秘儀 | 5色消しでコンボ倍率 **x2 / x3 / x5** | 8 |
| | 六色の秘儀 | 6色消しでコンボ倍率 **x3 / x5 / x8** | 10 |
| **コンボ数** | 三連の巧技 | 3コンボ**ちょうど**でコンボ加算 **+5 / +10 / +15** | 4 |
| | 十連の極み | 10コンボ**ちょうど**でコンボ加算 **+10 / +15 / +20** | 6 |
| | 七連の闘気 | 7コンボ**以上**でコンボ倍率 **x1.5 / x2 / x3** | 7 |
| **形状ボーナス** | 四連の術 | 4個消しでコンボ加算 **+1 / +2 / +3** | 3 |
| | 横一閃 | 横1列消しでコンボ加算 **+3 / +6 / +9** | 5 |
| | 四方の型 | 3x3正方形消しでコンボ倍率 **x1.5 / x2 / x3** | 6 |
| | 五星の印 | 5個以上消しで**次手**操作時間 **x1.2 / x1.5 / x2** | 5 |
| | 十字の祈り | 十字消しで**次手**操作時間 **x1.5 / x2 / x3** | 6 |
| | 鉤十字の型 | L字消しでコンボ加算 **+2 / +4 / +6** | 6 |
| | 癒しの波動 | 回復1コンボにつきコンボ加算 **+2 / +3 / +4** | 4 |
| **盤面拡張** | 巨人の領域 | **7x6盤面**になる。コンボ倍率 **x1 / x1.2 / x1.5** | 6 |
| **強化ドロップ** | マナの結晶化 | 落下ドロップの **5% / 10% / 20%** が強化される | 4 |
| | 強化増幅 | 強化ドロップ1個につきコンボ加算を **+1 / +2 / +3** (基礎値1からの加算) | 5 |
| | 過剰結合 | 強化ドロップ5個消しで倍率 **x1.5 / x2 / x3** | 6 |
| **高リスク** | 背水の陣 | **操作時間4秒固定**。コンボ倍率 **x3 / x4 / x5** | 8 |
| | 金満の暴力 | 所持スター **10 / 7 / 5** 個につき倍率 **+1** 加算 | 7 |
| | 偏食家 | 回復/光/闇が**出現しなくなる**。目標手数 **-2 / -1 / ±0** | 6 |
| | 呪われた力 | **操作時間-2秒**。常にコンボ加算 **+10 / +15 / +20** | 7 |
| **特殊条件** | (属性)の真髄 / 極致 | 指定属性を合計6/12個以上消すと倍率乗算 | 9~12 |
| | 会心の一撃 | 20%の確率で、最終倍率が **15 / 30 / 50倍** に上昇 | 10 |
| | 百般の型の極意 | 1ターンで異なる特殊消しを2種類以上発動で倍率乗算 | 12 |
| | 静寂の瞑想 | 0コンボ時、スキルのエネルギーを数チャージ | 9 |
| | 気まぐれなダイス | ターン毎にコンボ加算へランダムな値(-5〜+15等)を追加 | 6 |
| **コレクション** | 星の共鳴・延刻・極光 | 所持する特定レアリティトークン数に応じてコンボ数や時間を強化 | 6~9 |
| | 魔導の共犯 | 所持エンチャント数に応じてコンボ倍率を乗算 | 9 |

### 3. エンチャント (Enchantments)
トークンに付与される追加効果です。ショップで「高級品」として付与済みトークンが売られるか、「ランダム付与」アイテムで購入できます。

| 名前 (Name) | 効果 (Effect) | 価格 |
| :--- | :--- | :---: |
| **レベル共鳴** | **コンボ倍率** × (トークンLv) | 8 |
| **強欲の輝き** | **コンボ加算** + (現在の所持スター数) | 9 |
| **連鎖の刻印** | **コンボ加算** +2 | 5 |
| **時の刻印** | 1サイクルの最大ターン数 +1 | 7 |
| **時の跳躍** | **コンボ加算** + (前サイクルでスキップしたターン数) | 7 |
| **(属性)の加護** | 指定属性の1コンボにつき **コンボ加算 +1** | 6 |
| **(属性)の強化落下** | 指定属性のドロップが10%の確率で強化状態で落ちてくる | 5 |
| **(属性)の呼び声** | 指定属性のドロップが落ちやすくなる (加算) | 6 |
| **(属性)の静寂** | 指定属性のドロップが落ちにくくなる (乗算) | 6 |
| **(属性)の加護** | 各属性消去ごとの加算や、強化ドロップの確定落下など | 8 |
| **(形状)の極意** | 各特殊消し(4個/十字/L字/横一列/正方形)発動につき倍率乗算 | 8 |
| **状況限定系** | 1ターン目/最終ターン限定のブースト、色数指定消しブーストなど | 9~10 |
| **特殊効果系** | チャージ速度UP、売却価格アップ、レア変更、スキル消費減など | 6~10 |

### 4. ショップ仕様 (Shop System)
サイクルクリアごとに、デフォルトで以下の構成（レベルアップ → パッシブ → エンチャント → アクティブ枠の順）で商品が陳列されます。

1. **レベルアップ枠 (1枠)**: 所持しているトークン1つのLvを上げる「ランダム強化」(基本5★)。
2. **パッシブ枠 (3枠)**: ランダムなパッシブスキル。
3. **エンチャント枠 (2枠)**: ランダムなエンチャント付与アイテム。
4. **アクティブ枠 (4枠)**: ランダムなアクティブスキル。
   - **セール品**: 特定のパッシブスキル所持で、半額の商品が混ざることがあります。

- **枠の拡張**: 「陳列の極意」などの特定のスキル効果によって、パッシブやアクティブ商品の陳列枠数を増やすことが可能です。
- **リフレッシュ**: スターを消費して商品を新しく入れ替えます。使用するたびに費用が **1.5倍ずつ上昇** します。また、先のサイクルに進むにつれ、リフレッシュの**基礎費用も上昇**します（サイクルの開始時、目標達成時にリフレッシュ費用はデフォルト値にリセットされます）。

---

## 🚀 開発とデプロイ (Development & Deployment)

### 1. 依存関係のインストール
```bash
npm install
```

### 2. 開発サーバーの起動
```bash
npm run dev
```
ブラウザで `http://localhost:5173` などを開いてください。

### 3. ビルドとデプロイ
このプロジェクトは `gh-pages` を使用して GitHub Pages に簡単にデプロイできます。

**A. `vite.config.js` の確認**
`base` の設定が `'./'` になっていることを確認してください。

**B. デプロイコマンドの実行**
以下のコマンドを実行するだけで、プロジェクトがビルドされ、自動的に `gh-pages` ブランチにプッシュされます。

```bash
npm run deploy
```

**C. GitHub Pages の設定**
1. GitHub リポジトリの **Settings > Pages** を開きます。
2. **Build and deployment > Branch** で `gh-pages` ブランチの `/(root)` を選択して保存します。
3. 公開されるまで数分待ちます。

### その他のコマンド

| コマンド | 説明 |
|:---|:---|
| `npm run build` | プロジェクトを本番用にビルドします。(`dist` フォルダに生成) |
| `npm run preview` | ビルドされた内容をローカルでプレビューします。 |
| `npm run lint` | ESLintを実行してコードの静的解析を行います。 |